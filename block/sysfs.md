# Объекты kobject, ktype, kset

``` C
struct kobject { 
	char *k_name; // указатель на имя объекта
	char name[KOBJ_NAME_LEN]; // буфер для имени, если оно менее 20 символов
	struct kref kref; 
	struct list_head entry;
	struct kobject *parent; // указатель на родительский объект
	struct kset *kset;
	struct kobj_type *ktype;
	struct dentry *dentry; // указатель для представления объекта в sysfs
	//остальные поля нужны для поддержки объектов kobject
};
```

Структура kobject используется для представления наиболее общих объектных свойств структур данных ядра, таких как счетчик ссылок, взаимоотношения родитель-порожденный и имя объекта. С помощью структуры kobject эти свойства можно обеспечить одинаковым для всех стандартным способом. Сами по себе структуры kobject не очень полезны, они обычно встраиваются в другие структуры данных. Структуры, которые содержат в себе объекты kobject, становятся частью объектной иерархии.

Тип ktype имеет простое назначение — представлять общее поведение для некоторого семейства объектов kobject.  
Множества kset представляют собой коллекции объектов kobject. Множество kset работает как базовый контейнерный класс для объектов, например, "все блочные устройства".  

Одно из главных свойств, которое реализуется с помощью объектов kobject, — это унифицированная система поддержки счетчиков ссылок. Любой код, который работает с объектом, вначале должен увеличить значение счетчика ссылок. После того как код закончил работу с объектом, он должен уменьшить значение счетчика ссылок. Увеличение значения счетчика ссылок выполняется с помощью функции kobject_get(), а уменьшение - с помощью kobject_put().

## Как создать простейший объект kobject
В ранних версиях ядра (2.6 и ранее) это был многоступенчатый процесс, однако сейчас (версии 4.х) достаточно лишь вызвать функцию `struct kobject *kobject_create_and_add(char *name, struct kobject *parent);`. Данная функция проделает всю работу сама. В качестве родителя можно передать одного из существующих объектов в иерархии, либо достаточно просто передать `NULL` - в таком случае объект создастся на верхнем уровне иерархии.  
Больше полезной информации про kobject можно найти [тут](http://lxr.free-electrons.com/source/Documentation/kobject.txt). Подробно разобранный пример с созданием объекта и полей в нем, чтением и записью этих полей можно найти [тут](http://lxr.free-electrons.com/source/samples/kobject/kobject-example.c).

# Файловая система sysfs 

Файловая система sysfs — это виртуальная файловая система, которая позволяет просматривать иерархию объектов kobject. Она позволяет пользователям просматривать топологию устройств операционной системы в виде обычной файловой системы. Объекты представлены в виде файлов и каталогов, и с помощью такого представления облегчается задача конфигурации.  
Изначально система sysfs задумывалась как система для управления электропитанием, однако в дальнейшем стало понятно, что ее сфера применения гораздо шире.  
Обычно файловая система sysfs смонтирована на каталог /sys. Корневой каталог файловой системы sysfs содержит более 10 подкаталогов для всевозможных задач - напрмер, block, bus, devices. В каталоге block, к примеру, содержатся каталоги для каждого зарегистрированного в системе устройства блочного ввода-вывода. Каждый из каталогов, в свою очередь, содержит подкаталоги, соответствующие разделам блочного устройства.  
В данной иерархии объекты, описанные выше, представлены в виде каталогов, а поля указанного типа - это файлы.


